#!/usr/bin/bash
SCRIPT_NAME=${0##*/}

SHELLS=( "pwsh.exe" "powershell.exe" )
for SHELL in "${SHELLS[@]}"; do
    if command -v $SHELL &> /dev/null; then
        EXE=$SHELL
        break
    fi
done

if [[ $TMUX && $# == 0 ]]; then
    TMUX_TARGET=$(tmux display-message -p "#S:#{window_id}")
    tmux rename-window -t $TMUX_TARGET $SCRIPT_NAME
fi

if [[ $# == 0 ]]; then
    PWSH_WORKING_DIR="$(wslpath -m ${PWD})"
    if rg "^//wsl.localhost/" <<< "$PWSH_WORKING_DIR" > /dev/null; then
        PWSH_WORKING_DIR="$(wslpath -m ${WIN_HOME})"
    fi

    $EXE -NoLogo -NoExit -WorkingDirectory "${PWSH_WORKING_DIR}"
else
    $EXE "$@"
fi
